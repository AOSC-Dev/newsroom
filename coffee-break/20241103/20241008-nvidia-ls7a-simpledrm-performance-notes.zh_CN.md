NVIDIA 显卡及部分龙架构用户在近期内核更新后可能无法正常启动系统
===

自 6.10.12（稳定主线/mainline）及 6.6.53（长期支持/longterm) 内核更新以来，我们收到多名用户反馈称其在更新内核后，使用 NVIDIA、龙芯 7A 显卡无法正常启动系统，具体症状为：系统画面卡滞在 GRUB 启动内核的画面，系统实际成功启动（可通过 SSH 访问）后画面亦无变化。

排查结果
---

经查，我们发现近期内核有一个潜在缺陷：NVIDIA 等默认不启用内核态显示模式切换 (kernel modesetting) 的驱动在无 SimpleFB 及 SimpleDRM 驱动的情况下，可能无法正确交接显示画面。

但是，启用 SimpleFB 及 SimpleDRM 后，在部分龙架构配置下会出现一个分辨率为 800x600 或 1024x768 的“幽灵屏幕”（实际上是未正确关闭的 EFI 帧缓冲），此时桌面性能会大幅下降（根据游戏测试，至原来的 1/5 甚至 1/8）。

目前我们发现出现此问题的配置及设备有：

- 使用 AMD Radeon RX 5000/6000/7000 系列（RDNA 1.0/2.0/3.0 核心）等无龙芯原生固件支持的显卡，且同时使用主板视频输出显示固件及引导器的台式机
- 清华同方超锐 L860-T2（卓怡恒通 L71）

因此，我们对 NVIDIA 及龙架构用户提出如下不同的更新建议。

NVIDIA 及在龙架构设备上使用 AMD RDNA 显卡的机器的用户
---

6.10.13（稳定主线/mainline）及 6.6.54（长期支持/longterm) 将修复该问题

上述更新版本将于今日（UTC+8 时间 2024 年 10 月 8 日）推送，在此之前请使用 6.10.11 或 6.6.52 内核。

龙芯 7A 显卡用户
---

当前内核可能存在问题，无法正确在无显卡驱动的设备上启用 EFI 帧缓冲。

考虑到龙芯 7A 不在安同 OS 的支持范围内，为保障使用体验，我们强烈建议台式机用户添置基于 AMD GCN 1.0/2.0/3.0/4.0 或 RDNA 1.0/2.0/3.0 的显卡。

如您的设备无法安装额外显卡（如 NUC 小主机或笔记本），请暂时使用 6.10.11 或 6.6.52 内核规避该问题；如必须使用最新内核，您可以考虑添加内核模块载入配置（使用 6.10.11 或 6.6.52 内核启动系统，打开终端复制如下命令）：

```bash 
cat > /etc/modules-load.d/simpledrm.conf << EOF
simpledrm
EOF
```

而后重新生成初始化内存盘 (initramfs)：

```
sudo update-initramfs
```

重启电脑即可启动最新内核；请注意，在龙芯 7A 显卡驱动可用后，您可能需要删除该配置文件，否则可能遇到上述性能问题！
